<!DOCTYPE html>
<html>
<head>
  <title>The VexFlow Sandbox</title>
  <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT|Yanone+Kaffeesatz|Tangerine' rel='stylesheet' type='text/css'>

 <!-- midi.js package -->
 <script src="/m21j/ext/midijs/js/MIDI/AudioDetect.js" type="text/javascript"></script>
 <script src="/m21j/ext/midijs/js/MIDI/LoadPlugin.js" type="text/javascript"></script>
 <script src="/m21j/ext/midijs/js/MIDI/Plugin.js" type="text/javascript"></script>
 <script src="/m21j/ext/midijs/js/MIDI/Player.js" type="text/javascript"></script>
 <script src="/m21j/ext/midijs/js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
 <script src="/m21j/ext/midijs/js/Window/DOMLoader.script.js" type="text/javascript"></script>
 <!-- extras -->
 <script src="/m21j/ext/midijs/inc/Base64.js" type="text/javascript"></script>
 <script src="/m21j/ext/midijs/inc/base64binary.js" type="text/javascript"></script>

 <!-- VexFlow Compiled Source -->
 <script src='http://www.vexflow.com/support/vexflow-min.js'></script>

  <!-- Support Sources -->
 <script src='http://code.jquery.com/jquery-latest.js'></script>

  <style type="text/css">
    canvas {
      background: #eed;
      padding: 10px;
      border: 10px solid #ddc;
    }

    div.egcode {
      font-family: Courier;
      font-size: 12px;
    }
  </style>

  <script>
    /* Take raw javascript code, and return moderately useful HTML */
    function prettify_code(code) {
      var lines = code.split(/\r\n|\n|\r/);
      var new_lines = [];
      for (var j = 0; j < lines.length; ++j) {
        code = lines[j];
        code = code.replace(/\s/g, "&nbsp;");
        code = code.replace(/>/g, "&gt;");
        code = code.replace(/</g, "&lt;");
        new_lines.push(code);
      }

      pretty_code = "<div class='egcode'>" + new_lines.join("<br/>") + "</div>";
      return pretty_code;
    }

    /*
       Find all the javascript examples and copy their source code
       into the associated <code> blocks.
    */
    $(function() {
      $("div.description").each(function(index, sel) {
        codes = $(sel).find("code.example");
        codes.each(function(i, s) {
          var example = $(s).attr("example");
          var code = $($(sel).find(
            "div.example." + example + " script")[0]).html();
          $(s).html(prettify_code(code));
         })
      })
    })
  </script>
</head>

<body>
  <div class="header">
    <h1>The VexFlow Sandbox</h1>
    <div class="main">
      <b>A live editor for experimenting with VexFlow</b>
    </div>pre-pre-pre-alpha by <a href="http://0xfe.blogspot.com">0xfe</a>.
  </div>

  <div class="content">


    <h2>Have some fun!</h2>

    <div class="description sandbox">
      Try out the VexFlow API in this live editor.
      <p/>
      <div class="editor-error"><span class="text"></span></div>
      <p/>
      <div class="example sandbox" example="sandbox">
        <textarea id="sandbox" class="editor"
                  style="width: 1000px; height: 180px; ">
// Get the rendering context
var canvas = $("div.sandbox div.sandbox canvas")[0];
$(canvas).attr('width','300')

var renderer = new Vex.Flow.Renderer(canvas,
  Vex.Flow.Renderer.Backends.CANVAS);
var ctx = renderer.getContext();
for (var mn = 0; mn < 4; mn++) {
//ctx.clearRect(0, 0, canvas.width, canvas.height);
//ctx.setFont("Arial", 10, "").setBackgroundFillStyle("#eed");

// Create and draw the tablature stave
var tabstave = new Vex.Flow.Stave(10 + mn*190, 0, 190);
tabstave.setContext(ctx).draw();

// Create some notes
var notes = [];
for (var nn = 0; nn < 6; nn ++) {
  // A single note

  notes.push(new Vex.Flow.StaveNote({
    keys: ["Cn/4"],
    duration: "q"}))
};

Vex.Flow.Formatter.FormatAndDraw(ctx, tabstave, notes);
}
</textarea>
        <p/>
        <canvas width=625 height=160></canvas>

        <style>
        .editor {
          background: #cfc;
          border: 10px solid #afa;
          font-family: Courier;
          font-size: 14px;
        }


        div.editor-error .text {
          background: #faa;
          border: 5px solid #f88;
          font-family: Courier;
          font-size: 14px;
          padding: 3px;
          display: none;
        }

        </style>
        <script>

        var timeout;
        var msg = $('div.editor-error .text');

        function live_code() {
          var code = $("#sandbox").val();

          try {
            eval(code);
            msg.html('').hide();
          } catch (e) {
            msg.html(e.toString()).show();
          }

        }

        $('#sandbox').on('blur keyup paste', function() {
          if (timeout) clearTimeout(timeout);
          timeout = setTimeout(live_code, 200);
        });

        live_code();

        </script>
        <p/>
      </div>

  </div>
</body>

</html>
